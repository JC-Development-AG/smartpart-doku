<?xml version="1.0" encoding="UTF-8"?>
<ScriptObject><Version>1.0</Version>
<ScriptVersion>1.0</ScriptVersion>
<Name><![CDATA[CurvedText]]></Name>
<LibPath><![CDATA[]]></LibPath>
<Type>1</Type>
<SubType>0</SubType>
<UUID>edf885d0-0aa7-47ab-8aa4-306a35746fdf</UUID>
<Language>de</Language>
<StringTable>
</StringTable>
<RelativeOrigin>0.5000000000000000 0.5000000000000000 0.5000000000000000</RelativeOrigin>
<AbsoluteOrigin>0.0000000000000000 0.0000000000000000 0.0000000000000000</AbsoluteOrigin>
<SeparateExecParts>1</SeparateExecParts>
<Group>0</Group>
<AutoPlaceResourceObjects>1</AutoPlaceResourceObjects>
<AutoReferenceBox>1</AutoReferenceBox>
<Scale>1</Scale>
<Use3DPreview>0</Use3DPreview>
<Link>0</Link>
<Consider>0</Consider>
<SimplePlacing>0</SimplePlacing>
<HeightReference>0</HeightReference>
<HeightOffset>0.0000000000000000</HeightOffset>
<UnitFactor>1.0000000000000000</UnitFactor>
<PositionNumber>1</PositionNumber>
<IsLocked>0</IsLocked>
<IsEncrypted>0</IsEncrypted>
<Key><![CDATA[]]></Key>
<DependentFiles>
</DependentFiles>
<Parameters>
<Type>1</Type>
<AutoUpdateValues>1</AutoUpdateValues>
<MapPenToColor>0</MapPenToColor>
<Parameter>
<Identifier>bezier_points</Identifier>
<Name><![CDATA[Bezierkurve]]></Name>
<Group><![CDATA[]]></Group>
<Type>1</Type>
<Attribute>-1</Attribute>
<SystemID>0</SystemID>
<Expandable>0</Expandable>
<Hidden>0</Hidden>
<Lock>0</Lock>
<Export>0</Export>
<Save>1</Save>
<CurrentValue>
<Value>
<Type>6</Type>
<StringValue></StringValue>
<DoubleValue>0.000000000000</DoubleValue>
</Value>
</CurrentValue>
<ValueArray>
<Dimension>2</Dimension>
<Bounds>
<Bound Expandable="0">4</Bound>
<Bound Expandable="0">2</Bound>
<Bound Expandable="0">0</Bound>
<Bound Expandable="0">0</Bound>
<Bound Expandable="0">0</Bound>
<Bound Expandable="0">0</Bound>
<Bound Expandable="0">0</Bound>
<Bound Expandable="0">0</Bound>
<Bound Expandable="0">0</Bound>
<Bound Expandable="0">0</Bound>
</Bounds>
<Values>
<Value>
<Type>6</Type>
<StringValue></StringValue>
<DoubleValue>-1.162493670428</DoubleValue>
</Value>
<Value>
<Type>6</Type>
<StringValue></StringValue>
<DoubleValue>1.731697493333</DoubleValue>
</Value>
<Value>
<Type>6</Type>
<StringValue></StringValue>
<DoubleValue>3.146619733333</DoubleValue>
</Value>
<Value>
<Type>6</Type>
<StringValue></StringValue>
<DoubleValue>4.897973331404</DoubleValue>
</Value>
<Value>
<Type>6</Type>
<StringValue></StringValue>
<DoubleValue>1.813490125868</DoubleValue>
</Value>
<Value>
<Type>6</Type>
<StringValue></StringValue>
<DoubleValue>0.055541333333</DoubleValue>
</Value>
<Value>
<Type>6</Type>
<StringValue></StringValue>
<DoubleValue>2.441488640000</DoubleValue>
</Value>
<Value>
<Type>6</Type>
<StringValue></StringValue>
<DoubleValue>1.193493501640</DoubleValue>
</Value>
</Values>
</ValueArray>
</Parameter>
<Parameter>
<Identifier>char_width_factor</Identifier>
<Name><![CDATA[Zeichenbreitefaktor]]></Name>
<Group><![CDATA[]]></Group>
<Type>6</Type>
<Attribute>-1</Attribute>
<SystemID>0</SystemID>
<Expandable>0</Expandable>
<Hidden>0</Hidden>
<Lock>0</Lock>
<Export>0</Export>
<Save>1</Save>
<CurrentValue>
<Value>
<Type>6</Type>
<StringValue></StringValue>
<DoubleValue>1.000000000000</DoubleValue>
</Value>
</CurrentValue>
</Parameter>
<Parameter>
<Identifier>curved_text</Identifier>
<Name><![CDATA[Text]]></Name>
<Group><![CDATA[]]></Group>
<Type>3</Type>
<Attribute>-1</Attribute>
<SystemID>0</SystemID>
<Expandable>0</Expandable>
<Hidden>0</Hidden>
<Lock>0</Lock>
<Export>0</Export>
<Save>1</Save>
<CurrentValue>
<Value>
<Type>3</Type>
<StringValue><![CDATA[Text on a Bezier Curve]]></StringValue>
<DoubleValue>0.000000000000</DoubleValue>
</Value>
</CurrentValue>
</Parameter>
<Parameter>
<Identifier>font_name</Identifier>
<Name><![CDATA[Fontname]]></Name>
<Group><![CDATA[]]></Group>
<Type>3</Type>
<Attribute>-1</Attribute>
<SystemID>0</SystemID>
<Expandable>0</Expandable>
<Hidden>0</Hidden>
<Lock>0</Lock>
<Export>0</Export>
<Save>1</Save>
<CurrentValue>
<Value>
<Type>3</Type>
<StringValue><![CDATA[Arial]]></StringValue>
<DoubleValue>0.000000000000</DoubleValue>
</Value>
</CurrentValue>
</Parameter>
<Parameter>
<Identifier>ref_x</Identifier>
<Name><![CDATA[X-Abmessung]]></Name>
<Group><![CDATA[]]></Group>
<Type>1</Type>
<Attribute>-1</Attribute>
<SystemID>1</SystemID>
<Expandable>0</Expandable>
<Hidden>0</Hidden>
<Lock>0</Lock>
<Export>0</Export>
<Save>1</Save>
<CurrentValue>
<Value>
<Type>6</Type>
<StringValue></StringValue>
<DoubleValue>1.000000000000</DoubleValue>
</Value>
</CurrentValue>
</Parameter>
<Parameter>
<Identifier>ref_y</Identifier>
<Name><![CDATA[Y-Abmessung]]></Name>
<Group><![CDATA[]]></Group>
<Type>1</Type>
<Attribute>-1</Attribute>
<SystemID>2</SystemID>
<Expandable>0</Expandable>
<Hidden>0</Hidden>
<Lock>0</Lock>
<Export>0</Export>
<Save>1</Save>
<CurrentValue>
<Value>
<Type>6</Type>
<StringValue></StringValue>
<DoubleValue>1.000000000000</DoubleValue>
</Value>
</CurrentValue>
</Parameter>
<Parameter>
<Identifier>ref_z</Identifier>
<Name><![CDATA[Z-Abmessung]]></Name>
<Group><![CDATA[]]></Group>
<Type>1</Type>
<Attribute>-1</Attribute>
<SystemID>3</SystemID>
<Expandable>0</Expandable>
<Hidden>0</Hidden>
<Lock>0</Lock>
<Export>0</Export>
<Save>1</Save>
<CurrentValue>
<Value>
<Type>6</Type>
<StringValue></StringValue>
<DoubleValue>0.500000000000</DoubleValue>
</Value>
</CurrentValue>
</Parameter>
<Parameter>
<Identifier>text_color</Identifier>
<Name><![CDATA[Textfarbe]]></Name>
<Group><![CDATA[]]></Group>
<Type>7</Type>
<Attribute>-1</Attribute>
<SystemID>0</SystemID>
<Expandable>0</Expandable>
<Hidden>0</Hidden>
<Lock>0</Lock>
<Export>0</Export>
<Save>1</Save>
<CurrentValue>
<Value>
<Type>6</Type>
<StringValue></StringValue>
<DoubleValue>7.000000000000</DoubleValue>
</Value>
</CurrentValue>
</Parameter>
<Parameter>
<Identifier>text_size</Identifier>
<Name><![CDATA[Zeichenhöhe]]></Name>
<Group><![CDATA[]]></Group>
<Type>1</Type>
<Attribute>-1</Attribute>
<SystemID>0</SystemID>
<Expandable>0</Expandable>
<Hidden>0</Hidden>
<Lock>0</Lock>
<Export>0</Export>
<Save>1</Save>
<CurrentValue>
<Value>
<Type>6</Type>
<StringValue></StringValue>
<DoubleValue>5.000000000000</DoubleValue>
</Value>
</CurrentValue>
</Parameter>
</Parameters>
<Script><PartParameter>
<Enable>1</Enable>
<Text><![CDATA[! CurvedText
! (c) 2012, Manfred Moitzi, smartparts.tzb-moitzi.at
! License: GPLv3, www.fsf.org

VALUES "text_size" RANGE ( 0 , ] STEP 0.01 , 0.01 
VALUES "REF_Z" RANGE ( 0 , ] STEP 0.01 , 0.01 ]]></Text>
</PartParameter>
<PartMaster>
<Enable>0</Enable>
<Text><![CDATA[]]></Text>
</PartMaster>
<Part2D>
<Enable>1</Enable>
<Text><![CDATA[! CurvedText
! (c) 2012, Manfred Moitzi, smartparts.tzb-moitzi.at
! License: GPLv3, www.fsf.org

! Array bezier_points defines the top wave
! bezier_points[n][i] ... n=point number, i=axis (1=x-axis, 2=y-axis)
! global bezier curve definition points





axis_count = 2 

DIM result [ axis_count ] ! global result array
DIM bezier_factor [ 4 ] ! temp var for bezier point calculation

DEFINE STYLE "T1" font_name , text_size , 8 , 1 
SET STYLE "T1" 
COLOR text_color 

! calculate real text height in meters
real_text_height = text_size / 1000 * GLOB_SCALE 

length_of_text = STW ( curved_text ) 
pos = ( STW ( `A` ) / 2 ) 

GOSUB "str2array" 
! result: array chars[] contains characters of string "curved_text"

FOR i = 1 TO VARDIM1 ( chars ) 
   ! bezier parameter t = RANGE [0, 1]
   t = pos / length_of_text 
   ! get point on bezier curve at position 't'
   bezier_factor [ 1 ] = ( 1.0 - t ) ^ 3 
   bezier_factor [ 2 ] = 3.0 * ( 1.0 - t ) ^ 2 * t 
   bezier_factor [ 3 ] = 3.0 * ( 1.0 - t ) * t ^ 2 
   bezier_factor [ 4 ] = t ^ 3 
   GOSUB "bezier_calc" 
   x = result [ 1 ] 
   y = result [ 2 ] 
   ! get tangent on bezier curve at position 't'
   bezier_factor [ 1 ] = -3.0 * ( 1.0 - t ) ^ 2 
   bezier_factor [ 2 ] = 3.0 * ( 1.0 - 4.0 * t + 3.0 * t ^ 2 ) 
   bezier_factor [ 3 ] = 3.0 * t * ( 2.0 - 3.0 * t ) 
   bezier_factor [ 4 ] = 3.0 * t ^ 2 
   GOSUB "bezier_calc" 
   vx = result [ 1 ] 
   vy = result [ 2 ] 
   GOSUB "vector_to_angle" 
   ! result: alpha = angle of curve tangent
   IF i = 1 THEN ! store direction perpendicular to tangent of first character
      size_handle_vx = -vy 
      size_handle_vy = vx 
   ENDIF 
   ! place character at x,y with rotation alpha
   
   TRANS2 x , y 
   ROT2 alpha 
   SCALE2 char_width_factor , 1.0 
   ! Allplan 2013 doesn't scale 2D Text, perhaps it works in a later version
   TEXT2 0 , 0 , chars [ i ] 
   RESTORE 3 
   
   pos = pos + STW ( chars [ i ] ) 
NEXT i 


! place handle for bezier point (1)
HANDLE2 ( bezier_points [ 1 ] [ 1 ] ) , ( 0 ) , 1 , bezier_points [ 1 ] [ 2 ] , 1 
HANDLE2 ( bezier_points [ 1 ] [ 1 ] ) , ( bezier_points [ 1 ] [ 2 ] ) , 1 , bezier_points [ 1 ] [ 2 ] , 2 
HANDLE2 ( bezier_points [ 1 ] [ 1 ] ) , ( -1 ) , 1 , bezier_points [ 1 ] [ 2 ] , 3 
HANDLE2 ( 0 ) , ( bezier_points [ 1 ] [ 2 ] ) , 1 , bezier_points [ 1 ] [ 1 ] , 1 
HANDLE2 ( bezier_points [ 1 ] [ 1 ] ) , ( bezier_points [ 1 ] [ 2 ] ) , 1 , bezier_points [ 1 ] [ 1 ] , 2 
HANDLE2 ( -1 ) , ( bezier_points [ 1 ] [ 2 ] ) , 1 , bezier_points [ 1 ] [ 1 ] , 3 

! place handle for bezier point (2)
HANDLE2 ( bezier_points [ 2 ] [ 1 ] ) , ( 0 ) , 2 , bezier_points [ 2 ] [ 2 ] , 1 
HANDLE2 ( bezier_points [ 2 ] [ 1 ] ) , ( bezier_points [ 2 ] [ 2 ] ) , 2 , bezier_points [ 2 ] [ 2 ] , 2 
HANDLE2 ( bezier_points [ 2 ] [ 1 ] ) , ( -1 ) , 2 , bezier_points [ 2 ] [ 2 ] , 3 
HANDLE2 ( 0 ) , ( bezier_points [ 2 ] [ 2 ] ) , 2 , bezier_points [ 2 ] [ 1 ] , 1 
HANDLE2 ( bezier_points [ 2 ] [ 1 ] ) , ( bezier_points [ 2 ] [ 2 ] ) , 2 , bezier_points [ 2 ] [ 1 ] , 2 
HANDLE2 ( -1 ) , ( bezier_points [ 2 ] [ 2 ] ) , 2 , bezier_points [ 2 ] [ 1 ] , 3 

! place handle for bezier point (3)
HANDLE2 ( bezier_points [ 3 ] [ 1 ] ) , ( 0 ) , 3 , bezier_points [ 3 ] [ 2 ] , 1 
HANDLE2 ( bezier_points [ 3 ] [ 1 ] ) , ( bezier_points [ 3 ] [ 2 ] ) , 3 , bezier_points [ 3 ] [ 2 ] , 2 
HANDLE2 ( bezier_points [ 3 ] [ 1 ] ) , ( -1 ) , 3 , bezier_points [ 3 ] [ 2 ] , 3 
HANDLE2 ( 0 ) , ( bezier_points [ 3 ] [ 2 ] ) , 3 , bezier_points [ 3 ] [ 1 ] , 1 
HANDLE2 ( bezier_points [ 3 ] [ 1 ] ) , ( bezier_points [ 3 ] [ 2 ] ) , 3 , bezier_points [ 3 ] [ 1 ] , 2 
HANDLE2 ( -1 ) , ( bezier_points [ 3 ] [ 2 ] ) , 3 , bezier_points [ 3 ] [ 1 ] , 3 

! place handle for bezier point (4)
HANDLE2 ( bezier_points [ 4 ] [ 1 ] ) , ( 0 ) , 4 , bezier_points [ 4 ] [ 2 ] , 1 
HANDLE2 ( bezier_points [ 4 ] [ 1 ] ) , ( bezier_points [ 4 ] [ 2 ] ) , 4 , bezier_points [ 4 ] [ 2 ] , 2 
HANDLE2 ( bezier_points [ 4 ] [ 1 ] ) , ( -1 ) , 4 , bezier_points [ 4 ] [ 2 ] , 3 
HANDLE2 ( 0 ) , ( bezier_points [ 4 ] [ 2 ] ) , 4 , bezier_points [ 4 ] [ 1 ] , 1 
HANDLE2 ( bezier_points [ 4 ] [ 1 ] ) , ( bezier_points [ 4 ] [ 2 ] ) , 4 , bezier_points [ 4 ] [ 1 ] , 2 
HANDLE2 ( -1 ) , ( bezier_points [ 4 ] [ 2 ] ) , 4 , bezier_points [ 4 ] [ 1 ] , 3 


! place text size handle
x = bezier_points [ 1 ] [ 1 ] 
y = bezier_points [ 1 ] [ 2 ] 

! normalize direction vector
size_handle_length = SQR ( size_handle_vx ^ 2 + size_handle_vy ^ 2 ) 
vx = size_handle_vx / size_handle_length 
vy = size_handle_vy / size_handle_length 

dx = vx * real_text_height 
dy = vy * real_text_height 

! calibrate handle
HANDLEFACTOR text_size / real_text_height 


! place character size handle
HANDLE2 ( x ) , ( y ) , 5 , text_size , 1 
HANDLE2 ( x + dx ) , ( y + dy ) , 5 , text_size , 2 
HANDLE2 ( x - dx ) , ( y - dy ) , 5 , text_size , 3 


END 

!--------------------------------------------------------------
"str2Array": 
DIM chars [ STRLEN ( curved_text ) ] 
FOR __i__ = 1 TO STRLEN ( curved_text ) 
   chars [ __i__ ] = STRSUB ( curved_text , __i__ , 1 ) 
NEXT __i__ 
RETURN 

"vector_to_angle": 
IF vx <> 0 THEN 
   alpha = ATAN ( vy / vx ) 
   IF vx < 0 THEN 
      alpha = alpha + 180 
   ENDIF 
   ELSE 
   IF vy > 0 THEN 
      alpha = 90 
      ELSE 
      alpha = -90 
   ENDIF 
ENDIF 
RETURN 

"bezier_calc": 
FOR __i__ = 1 TO axis_count 
   result [ __i__ ] = 0.0 
NEXT __i__ 

FOR __i__ = 1 TO 4 
   FOR __axis__ = 1 TO axis_count 
      result [ __axis__ ] = result [ __axis__ ] + bezier_points [ __i__ ] [ __axis__ ] * bezier_factor [ __i__ ] 
   NEXT __axis__ 
NEXT __i__ 
RETURN 
!--------------------------------------------------------------]]></Text>
</Part2D>
<Part3D>
<Enable>0</Enable>
<Text><![CDATA[
]]></Text>
</Part3D>
<PartDialog>
<Enable>1</Enable>
<Text><![CDATA[! CurvedText
! (c) 2012, Manfred Moitzi, smartparts.tzb-moitzi.at
! License: GPLv3, www.fsf.org

I_PALETTE `CurvedText` , 1 , 
"(c) 2012 Manfred Moitzi" , "link=http://smartparts.tzb-moitzi.at TZBM" , 
"General Public License v3 (GPLv3)" , "link=http://www.gnu.org/licenses/ Lizenz" 

I_INFIELD "curved_text" , 0 , 0 , 1 , 1 
I_INFIELD "text_color" , 0 , 0 , 1 , 1 
I_INFIELD "text_size" , 0 , 0 , 1 , 1 I_TOOLTIP `in [mm] am Papier` 
I_INFIELD "char_width_factor" , 0 , 0 , 1 , 1 I_TOOLTIP `Verhältnis Zeichenbreite/Zeichenhöhe
Faktor 2 = 2x so breit wie hoch
funktionert in Allplan 2013 leider noch nicht!` 
I_INFIELD "font_name" , 0 , 0 , 1 , 1 ]]></Text>
</PartDialog>
</Script>
<Drawing2D>
</Drawing2D>
<Drawing3D>
</Drawing3D>
<Pictures>
<ImportBitmaps>0</ImportBitmaps>
<ManageInList>1</ManageInList>
<Picture Name="0" Type="png" Width="146" Height="159"><![CDATA[89504E470D0A1A0A0000000D49484452000000920000009F080600000012E58050000000017352474200AECE1CE90000000467414D410000B18F0BFC6105000000097048597300000EC300000EC301C76FA8640000055249444154785EEDDADD6EDB301044E1BEFF4BB7E845008325352367E3FCF4CB4D1068B4960E0F97EBA2BF7EFB416080C0AF811A4A20F09B4824182140A4118C8A1089032304883482511122716084009146302A42240E8C1020D208464588C4811102441AC1A8089138304280482318152112074608106904A32244E2C00801228D605484481C182140A4118C8A1089032304883482511122716084009146302A42240E8C1020D208464588C4811102441AC1A8089138304280482318152112074608106904A32244E2C00801228D605484481C182140A4118C8A1089032304883482511122716084009146302A42240E8C1020D208464588C4811102441AC1A8089138304280482318152112074608106904A32244E2C00801228D605484481C182140A4118C8A1089032304883482511122716084009146302A42240E8C1020D208464588C4811102441AC1A80891383042804823181521120746081C45FA45B111C0FF4B914B91FECA44A8FF4585F7BDE756A437791E7F13EA7DA07FFADD95487F21E84E5F4785B7B5D8FDFEACA7FC47A4B50B3D0AF4D89588F59A25BB92E5F1DADBD37C965C5B915661DE3AD2233AC7DEAC48A72EF3781A5CADCB6E939F9AC2478C29C7A36D37273D5ABFCAA5437562B5C2ACDDE6B47177B2ACA3C82B8EC2CB2FF9BBD6F928D0D52EE8B0FEEC547B2C9D36ED3A56ECC68C9D60BBCED5ACDB7B3A55F5AF45A7967ADA35FFEB70BE8AB31E4B57336623C9BAD0CD8C7475349E247C46A84AA475364AC6AFF63FF360DFA557A56363D76D1AA1AEE69BABCFBC92B99DB79E6904B745DA9DBFBB79E96A86FACEF3D46EA1D66F4CBBBF4F429D8EAF2946CF3CEFAE53A58DFD9448A7AF9ABB61FCD4B2AF5E303DF42BAE9F76FDE9B85A45D975E58F96A6E172A783DE59A37789B48A7382D77CC3BB5AB806D0B3993BC2EC8E9BDD31B0EB267716E5D977B97BDFE939AF4E98D3983222523343DDD9B1BB19E2CE5C70277BD55D1FEBA44DB3EB54BBFBEF2EF62BF2EB73AE82ED78AECF352ED2D57C90E6A6B5A39D16271DADEB7D3BD157594FBB7057EB04F62B769DBB22A693E1651DE91F5397FF41B0B3BF391E76F3C57ADFDAF5AE8EA2ABCFDCDD97E69B13E0BB0BF955F2EBFBAE1BED651DE904E4AA8D36929DDAEED5D1B3136E95A5ED3C3F4D98246EDB653FEC684B0FD82CDCEE685B85B9DA39A76BA7D9A785D6BCDB4FCBA40DF4A92225D85743F39564A76BCD109E9EC9F53D812F2DD2D5A23552E830AFD3FEDB8AF43A443EA92140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C2440A48848A02140A486924C24F00740339AF1274366A30000000049454E44AE426082]]></Picture>
</Pictures>
</ScriptObject>